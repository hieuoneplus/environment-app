<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <div class="header-content">
        <span>ğŸ Cá»­a HÃ ng Äá»•i QuÃ </span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="reward-content">
  <!-- Points Display -->
  <div class="points-header">
    <div class="points-info">
      <span class="points-label">Äiá»ƒm cá»§a báº¡n:</span>
      <div class="points-value">
        <span class="points-number">{{userPoints | number}} GP</span>
        <ion-icon name="diamond" class="diamond-icon"></ion-icon>
      </div>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="category-section">
    <ion-segment [(ngModel)]="selectedCategory" (ionChange)="onCategoryChange()" class="category-segment">
      <ion-segment-button *ngFor="let cat of categories" [value]="cat.value">
        <ion-label>{{cat.label}}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <p>Äang táº£i...</p>
  </div>

  <!-- Rewards Grid -->
  <div class="rewards-grid" *ngIf="!isLoading">
    <ion-card 
      *ngFor="let reward of filteredRewards" 
      class="reward-card"
      [class.affordable]="reward.canAfford"
      [class.unaffordable]="!reward.canAfford">
      <div class="reward-image">
        <span class="reward-emoji">{{reward.imageEmoji || 'ğŸ'}}</span>
      </div>
      <ion-card-header>
        <ion-card-title>{{reward.name}}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="reward-description" *ngIf="reward.description">
          <p>{{reward.description}}</p>
        </div>
        <div class="reward-points">
          <ion-icon name="diamond" class="diamond-small"></ion-icon>
          <span class="points-text">{{reward.points | number}} GP</span>
        </div>
        <ion-button 
          expand="block" 
          class="exchange-btn"
          [disabled]="!reward.canAfford"
          (click)="exchangeReward(reward)">
          {{reward.canAfford ? 'Äá»”I NGAY' : 'KHÃ”NG Äá»¦ ÄIá»‚M'}}
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredRewards.length === 0" class="empty-state">
    <p>KhÃ´ng cÃ³ pháº§n thÆ°á»Ÿng nÃ o</p>
  </div>
</ion-content>

<!-- Confirmation Dialog -->
<div class="confirm-dialog-overlay" *ngIf="showConfirmDialog" (click)="closeConfirmDialog()">
  <div class="confirm-dialog" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <div class="dialog-icon">ğŸ</div>
      <h2 class="dialog-title">XÃ¡c nháº­n Ä‘á»•i quÃ </h2>
    </div>
    
    <div class="dialog-content" *ngIf="selectedReward">
      <div class="reward-preview">
        <div class="preview-emoji">{{selectedReward.imageEmoji || 'ğŸ'}}</div>
        <h3 class="preview-name">{{selectedReward.name}}</h3>
        <div class="preview-points">
          <ion-icon name="diamond" class="diamond-preview"></ion-icon>
          <span>{{selectedReward.points | number}} GP</span>
        </div>
      </div>
      
      <div class="points-info">
        <div class="points-before">
          <span class="label">Äiá»ƒm hiá»‡n táº¡i:</span>
          <span class="value">{{userPoints | number}} GP</span>
        </div>
        <div class="points-after">
          <span class="label">Äiá»ƒm cÃ²n láº¡i:</span>
          <span class="value highlight">{{(userPoints - selectedReward.points) | number}} GP</span>
        </div>
      </div>
    </div>
    
    <div class="dialog-actions">
      <ion-button 
        fill="outline" 
        class="cancel-btn"
        (click)="closeConfirmDialog()">
        Há»§y
      </ion-button>
      <ion-button 
        class="confirm-btn"
        (click)="handleConfirmExchange()">
        XÃ¡c nháº­n
      </ion-button>
    </div>
  </div>
</div>
